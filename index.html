<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>üåç Guess Globe</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  
  <!-- –§–æ–Ω–æ–≤–∞—è –º—É–∑—ã–∫–∞ -->
  <audio id="bg-music" loop preload="auto">
    <source src="https://cdn.jsdelivr.net/gh/lisofoxa-oss/guess-globe-assets@main/Next_to_You.mp3" type="audio/mpeg">
  </audio>
  
<style>
  * {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
    font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', 'Segoe UI', Roboto, sans-serif;
  }

  html, body {
    height: 100%;
    overflow: hidden;
  }

  body {
    display: flex;
    flex-direction: column;
    justify-content: center;
    padding: env(safe-area-inset-top) 12px env(safe-area-inset-bottom) 12px;
    max-height: 100vh;
    transition: all 0.4s ease;
  }

  /* === –¢–ï–ú–ê –¢–Å–ú–ù–ê–Ø –ù–ï–û–ù–û–í–ê–Ø === */
  body.theme-dark {
    background: 
      radial-gradient(circle at 20% 20%, rgba(76, 175, 80, 0.3), transparent 50%),
      radial-gradient(circle at 80% 80%, rgba(156, 39, 176, 0.3), transparent 50%),
      linear-gradient(135deg, #050816, #0b1020);
    color: #f5f5ff;
  }

  body.theme-dark .container {
    background: rgba(10, 14, 35, 0.85);
    border: 1px solid rgba(255, 255, 255, 0.08);
    box-shadow: 0 20px 50px rgba(0, 0, 0, 0.9), 0 0 0 1px rgba(255, 255, 255, 0.02);
    backdrop-filter: blur(24px);
  }

  /* === –¢–ï–ú–ê –°–í–ï–¢–õ–ê–Ø –ö–ê–†–¢–û–ß–ö–ê === */
  body.theme-light {
    background: 
      radial-gradient(circle at 20% 20%, rgba(129, 199, 132, 0.35), transparent 50%),
      radial-gradient(circle at 80% 80%, rgba(255, 235, 59, 0.25), transparent 50%),
      linear-gradient(135deg, #2e7d32, #5cb85c);
    color: #ffffff;
  }

  body.theme-light .container {
    background: rgba(255, 255, 255, 0.15);
    border: 1px solid rgba(255, 255, 255, 0.25);
    box-shadow: 0 16px 40px rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(20px);
  }

  .container {
    position: relative;
    max-width: 480px;
    width: 100%;
    margin: 0 auto;
    border-radius: 24px;
    padding: 20px 16px;
    flex: 1;
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  .screen { 
    display: none; 
    flex-direction: column;
    flex: 1;
  }

  .screen.active { 
    display: flex; 
  }

  .close-btn, .theme-btn, .music-toggle {
    position: absolute;
    width: 36px;
    height: 36px;
    border: none;
    border-radius: 50%;
    font-size: 16px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
    backdrop-filter: blur(12px);
    z-index: 10;
  }
  
  /* –ü–†–ê–í–´–ô –í–ï–†–•–ù–ò–ô –£–ì–õ–û–ö: ‚ô™ ‚òÄÔ∏è ‚úï */
  .music-toggle { top: 14px; right: 102px; }  /* —Å–∞–º–∞—è –ª–µ–≤–∞—è */
  .theme-btn { top: 14px; right: 54px; }      /* —Å–µ—Ä–µ–¥–∏–Ω–∞ */
  .close-btn { top: 14px; right: 14px; }      /* –ø—Ä–∞–≤–∞—è (–∫–∞–∫ –±—ã–ª–æ) */


  body.theme-dark .close-btn, body.theme-dark .theme-btn, body.theme-dark .music-toggle {
    background: rgba(255, 255, 255, 0.15);
    color: #ffffff;
    border: 1px solid rgba(255, 255, 255, 0.2);
  }

  body.theme-light .close-btn, body.theme-light .theme-btn, body.theme-light .music-toggle {
    background: rgba(255, 255, 255, 0.3);
    color: #ffffff;
    border: 1px solid rgba(255, 255, 255, 0.4);
  }

  .close-btn:active, .theme-btn:active, .music-toggle:active {
    transform: scale(0.92);
  }

  /* Top bar */
  .top-bar {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 16px;
  }

  .logo-mark {
    width: 36px;
    height: 36px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
  }

  body.theme-dark .logo-mark { background: linear-gradient(135deg, #4caf50, #8bc34a); }
  body.theme-light .logo-mark { background: rgba(255, 255, 255, 0.9); color: #2e7d32; }

  .title-main { font-size: 20px; font-weight: 700; }
  .title-sub { font-size: 13px; opacity: 0.85; }

  /* –ö–Ω–æ–ø–∫–∏ */
  .mode-btn, .btn, .start-btn, .restart-btn {
    border: none;
    border-radius: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    text-align: center;
  }

  .mode-btn {
    padding: 16px;
    margin: 8px 0;
    font-size: 16px;
  }

  body.theme-dark .mode-btn {
    background: rgba(255, 255, 255, 0.12);
    color: #f5f5ff;
    border: 1px solid rgba(255, 255, 255, 0.15);
  }

  body.theme-light .mode-btn {
    background: rgba(255, 255, 255, 0.95);
    color: #2e7d32;
  }

  .level-item {
    padding: 16px;
    margin: 8px 0;
    cursor: pointer;
    border-radius: 16px;
    transition: all 0.2s ease;
  }

  body.theme-dark .level-item { 
    background: rgba(255, 255, 255, 0.08);
    border: 1px solid rgba(255, 255, 255, 0.1);
    color: #f5f5ff;
  }

  body.theme-light .level-item { 
    background: rgba(0, 0, 0, 0.2);
    border: 1px solid rgba(255, 255, 255, 0.3);
    color: #ffffff;
  }

  .level-item.selected.easy {
    background: rgba(76, 175, 80, 0.3) !important;
    border-color: #4caf50 !important;
    box-shadow: 0 0 20px rgba(76, 175, 80, 0.6);
  }

  .level-item.selected.medium {
    background: rgba(255, 193, 7, 0.3) !important;
    border-color: #ffc107 !important;
    box-shadow: 0 0 20px rgba(255, 193, 7, 0.6);
  }

  .level-item.selected.hard {
    background: rgba(244, 67, 54, 0.3) !important;
    border-color: #f44336 !important;
    box-shadow: 0 0 20px rgba(244, 67, 54, 0.6);
  }

  .start-btn, .restart-btn {
    padding: 16px 24px;
    font-size: 16px;
    width: 100%;
    max-width: 300px;
    margin-top: 16px;
  }

  .start-btn {
    opacity: 0.6;
    pointer-events: none;
  }

  .start-btn.active {
    opacity: 1;
    pointer-events: auto;
    background: linear-gradient(135deg, #4caf50, #66bb6a);
    color: white;
    box-shadow: 0 8px 25px rgba(76, 175, 80, 0.5);
  }

  /* –ò–≥—Ä–æ–≤–æ–π —ç–∫—Ä–∞–Ω */
  .progress { font-size: 14px; margin-bottom: 8px; opacity: 0.9; }
  .stats { 
    padding: 10px; 
    border-radius: 12px; 
    margin-bottom: 12px; 
    font-size: 13px;
    justify-content: space-between;
  }

  #question-text {
    font-size: 22px;
    font-weight: 700;
    text-align: center;
    margin: 12px 0;
    display: none;
  }

  .flag-container {
    padding: 20px;
    border-radius: 20px;
    margin: 12px 0;
    min-height: 140px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  body.theme-dark .flag-container {
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.15);
  }

  body.theme-light .flag-container {
    background: rgba(255, 255, 255, 0.25);
    border: 2px dashed rgba(255, 255, 255, 0.5);
  }

  .loading { font-size: 16px; opacity: 0.8; }
  .flag {
    max-width: 100%;
    max-height: 120px;
    object-fit: contain;
    border-radius: 12px;
    display: none;
  }

  .timer-bar {
    height: 6px;
    border-radius: 3px;
    margin: 12px 0;
    overflow: hidden;
    background: rgba(255, 255, 255, 0.2);
  }

  .timer-fill {
    height: 100%;
    background: linear-gradient(90deg, #4caf50, #ffeb3b, #f44336);
    width: 100%;
    transition: width 0.1s linear;
  }

  #options {
    flex: 1;
    overflow-y: auto;
    margin: 8px 0;
    padding-right: 2px;
  }

  .btn {
    width: 100%;
    padding: 14px;
    margin: 6px 0;
    font-size: 15px;
    border-radius: 14px;
  }

  body.theme-dark .btn {
    background: rgba(255, 255, 255, 0.1);
    color: #f5f5ff;
    border: 1px solid rgba(255, 255, 255, 0.15);
  }

  body.theme-light .btn {
    background: rgba(255, 255, 255, 0.95);
    color: #2e7d32;
  }

  .btn:disabled { opacity: 0.7; }
  .btn.correct { 
    background: #4caf50 !important; 
    color: white !important; 
    box-shadow: 0 0 20px rgba(76, 175, 80, 0.8) !important;
  }
  .btn.incorrect { 
    background: #f44336 !important; 
    color: white !important; 
    box-shadow: 0 0 20px rgba(244, 67, 54, 0.8) !important;
  }

  .options-grid {
    display: grid;
    gap: 10px;
    margin: 12px 0;
  }
  
  /* –õ–Å–ì–ö–ò–ô: 2x2 = 4 —Ñ–ª–∞–≥–∞ */
  .options-grid.easy { 
    grid-template-columns: repeat(2, 1fr);
    grid-template-rows: repeat(2, 80px);
  }
  
  /* –°–†–ï–î–ù–ò–ô: 2x3 = 6 —Ñ–ª–∞–≥–æ–≤ (5-–π —à–∏—Ä–µ) */
  .options-grid.medium { 
    grid-template-columns: repeat(2, 1fr);
    grid-template-rows: repeat(3, 70px);
  }
  .options-grid.medium .btn:nth-child(5) { 
    grid-column: span 2; 
    grid-row: span 1;
    height: 70px;
  }
  
  /* –°–õ–û–ñ–ù–´–ô: 2x3 = 6 —Ñ–ª–∞–≥–æ–≤ */
  .options-grid.hard { 
    grid-template-columns: repeat(2, 1fr);
    grid-template-rows: repeat(3, 70px);
  }
  
  .btn.flag-option {
    padding: 6px;
    height: 70px;  /* —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤—ã—Å–æ—Ç–∞ */
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .btn.flag-option img {
    width: 100%;
    height: 60px;
    max-width: 100px;
    object-fit: contain;
    border-radius: 8px;
  }

  #result {
    text-align: center;
    font-size: 16px;
    font-weight: 600;
    margin-top: 8px;
    min-height: 24px;
  }

  /* –§–∏–Ω–∞–ª—å–Ω—ã–π —ç–∫—Ä–∞–Ω */
  .final-screen h2 {
    font-size: 24px;
    text-align: center;
    margin: 16px 0;
  }

  .final-score {
    font-size: 52px;
    font-weight: 800;
    text-align: center;
    margin: 16px 0;
  }

  #final-message {
    text-align: center;
    font-size: 16px;
    margin: 12px 0;
    opacity: 0.9;
  }

  .restart-btn {
    background: linear-gradient(135deg, #4caf50, #66bb6a);
    color: white;
    box-shadow: 0 8px 25px rgba(76, 175, 80, 0.5);
  }

  /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
  @keyframes glow { 0%, 100% { box-shadow: 0 0 10px #4caf50; } 50% { box-shadow: 0 0 25px #66bb6a; } }
  @keyframes glow-red { 0%, 100% { box-shadow: 0 0 10px #f44336; } 50% { box-shadow: 0 0 25px #ef5350; } }

  .flag.success { animation: glow 0.8s ease-in-out; }
  .flag.error { animation: glow-red 0.8s ease-in-out; }

  /* –°–∫—Ä–æ–ª–ª–±–∞—Ä */
  #options::-webkit-scrollbar { width: 4px; }
  #options::-webkit-scrollbar-thumb { border-radius: 2px; background: rgba(255,255,255,0.3); }

  /* –ö–Ω–æ–ø–∫–∏ –Ω–µ –º–µ—à–∞—é—Ç –Ω–∞ –∏–≥—Ä–æ–≤–æ–º —ç–∫—Ä–∞–Ω–µ */
  #game-screen .theme-btn,
  #game-screen .close-btn,
  #level-screen .theme-btn,
  #final-screen .theme-btn {
    opacity: 0.3;
  }
  
  #game-screen:hover .theme-btn,
  #game-screen:hover .close-btn {
    opacity: 0.8;
  }
  
  /* –§–ª–∞–≥–∏ –±–ª–∏–∂–µ –¥—Ä—É–≥ –∫ –¥—Ä—É–≥—É */
  .options-grid {
    gap: 8px;  /* –º–µ–Ω—å—à–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ */
  }
</style>


</head>
<body class="theme-dark">
  <div class="container">
    <!-- –ö–Ω–æ–ø–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ (–ù–ï –º–µ—à–∞—é—Ç) -->
    <button class="music-toggle" id="music-toggle" onclick="toggleMusic()">‚ô™</button>
    <button id="theme-toggle" class="theme-btn">‚òÄÔ∏è</button>
    <button class="close-btn" onclick="window.Telegram.WebApp.close()">‚úï</button>
  
    <!-- –ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω -->
    <div id="main-screen" class="screen active">
      <div class="top-bar">
        <div class="logo-mark">üåç</div>
        <div class="title-block">
          <div class="title-main">Guess Globe</div>
          <div class="title-sub">–£–≥–∞–¥–∞–π —Ñ–ª–∞–≥ —Å—Ç—Ä–∞–Ω—ã</div>
        </div>
      </div>
      <button class="mode-btn" onclick="startGame('flag-to-country')">
        üè≥Ô∏è –§–ª–∞–≥ ‚Üí –°—Ç—Ä–∞–Ω–∞
      </button>
      <button class="mode-btn" onclick="startGame('country-to-flag')">
        üåç –°—Ç—Ä–∞–Ω–∞ ‚Üí –§–ª–∞–≥
      </button>
      <div style="text-align: center; margin-top: 20px; font-size: 12px; opacity: 0.6;">
        v1.2.6
      </div>
    </div>

    <!-- –í—ã–±–æ—Ä —É—Ä–æ–≤–Ω—è -->
    <div id="level-screen" class="screen">
      <div class="top-bar">
        <div class="logo-mark">‚ö°</div>
        <div class="title-block">
          <div class="title-main">–í—ã–±–µ—Ä–∏ —Å–ª–æ–∂–Ω–æ—Å—Ç—å</div>
        </div>
      </div>
      <div class="level-item" data-level="easy">
        <div class="level-title">üü¢ –õ—ë–≥–∫–∏–π</div>
        <div style="font-size: 14px; opacity: 0.9;">30 —Å–∞–º—ã—Ö —É–∑–Ω–∞–≤–∞–µ–º—ã—Ö —Ñ–ª–∞–≥–æ–≤<br>4 –≤–∞—Ä–∏–∞–Ω—Ç–∞ –æ—Ç–≤–µ—Ç–∞</div>
      </div>
      <div class="level-item" data-level="medium">
        <div class="level-title">üü° –°—Ä–µ–¥–Ω–∏–π</div>
        <div style="font-size: 14px; opacity: 0.9;">100+ —Å—Ç—Ä–∞–Ω –º–∏—Ä–∞<br>5 –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –æ—Ç–≤–µ—Ç–∞</div>
      </div>
      <div class="level-item" data-level="hard">
        <div class="level-title">üî¥ –°–ª–æ–∂–Ω—ã–π</div>
        <div style="font-size: 14px; opacity: 0.9;">–í—Å–µ 195 —Å—Ç—Ä–∞–Ω<br>6 –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –æ—Ç–≤–µ—Ç–∞</div>
      </div>
      <button class="start-btn" id="start-btn">‚ñ∂Ô∏è –ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
    </div>

    <!-- –ò–≥—Ä–æ–≤–æ–π —ç–∫—Ä–∞–Ω -->
    <div id="game-screen" class="screen">
      <div class="progress">–í–æ–ø—Ä–æ—Å <span id="current">1</span> –∏–∑ 10</div>
      <div class="stats">
        <div>‚úÖ –í–µ—Ä–Ω–æ: <span id="correct">0</span></div>
      </div>
      <div id="question-text"></div>
      <div id="flag-block">
        <div class="flag-container">
          <div id="loading" class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–ª–∞–≥–∞...</div>
          <img id="flag" class="flag" alt="–§–ª–∞–≥">
        </div>
      </div>
      <div class="timer-bar">
        <div id="timer-fill" class="timer-fill"></div>
      </div>
      <div id="options"></div>
      <div id="result"></div>
    </div>

    <!-- –§–∏–Ω–∞–ª—å–Ω—ã–π —ç–∫—Ä–∞–Ω -->
    <div id="final-screen" class="screen">
      <div class="top-bar">
        <div class="logo-mark">üèÜ</div>
        <div class="title-block">
          <div class="title-main">–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞!</div>
        </div>
      </div>
      <div class="final-score"><span id="final-correct">0</span>/10</div>
      <div id="final-message"></div>
      <button class="restart-btn" onclick="restartGame()">üéÆ –ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
    </div>

    <button class="close-btn" onclick="window.Telegram.WebApp.close()">‚úï</button>
    <button class="music-toggle" id="music-toggle" onclick="toggleMusic()">‚ô™</button>
  </div>

  <!-- –ö–æ–Ω—Ñ–µ—Ç—Ç–∏ -->
  <div id="confetti"></div>

  <!-- –¢–í–û–ô AUDIO –∏ —Å–∫—Ä–∏–ø—Ç—ã –Ω–∏–∂–µ -->


<script>
  const tg = window.Telegram.WebApp;
  tg.expand();
  tg.ready();

  let currentLevel = "";
  let gameMode = "";
  let questions = [];
  let currentQuestionIndex = 0;
  let correctCount = 0;
  let timeLeft = 10;
  let timerInterval;
  let isDarkTheme = true;

  // –ú—É–∑—ã–∫–∞
  function toggleMusic() {
    const bgMusic = document.getElementById('bg-music');
    const btn = document.getElementById('music-toggle');
    if (bgMusic.paused) {
      bgMusic.play().catch(() => {});
      btn.textContent = 'üîá';
    } else {
      bgMusic.pause();
      btn.textContent = '‚ô™';
    }
  }

  // –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–µ–º—ã
  document.getElementById('theme-toggle').onclick = () => {
    isDarkTheme = !isDarkTheme;
    document.body.className = isDarkTheme ? 'theme-dark' : 'theme-light';
    document.getElementById('theme-toggle').textContent = isDarkTheme ? '‚òÄÔ∏è' : 'üåô';
    localStorage.setItem('guessGlobeTheme', isDarkTheme ? 'dark' : 'light');
  };

  // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ–º—ã
  const savedTheme = localStorage.getItem('guessGlobeTheme');
  if (savedTheme === 'light') {
    isDarkTheme = false;
    document.body.className = 'theme-light';
    document.getElementById('theme-toggle').textContent = 'üåô';
  }

  function startGame(mode) {
    gameMode = mode;
    showScreen('level-screen');
    
    document.querySelectorAll('.level-item').forEach(item => {
      item.onclick = () => {
        document.querySelectorAll('.level-item').forEach(i => {
          i.classList.remove('selected', 'easy', 'medium', 'hard');
        });
        item.classList.add('selected', item.dataset.level);
        currentLevel = item.dataset.level;
        document.getElementById('start-btn').classList.add('active');
      };
    });
  }

  async function fetchQuestions() {
    try {
      const response = await fetch(`https://guess-globe-backend.onrender.com/api/questions?level=${currentLevel}&mode=${gameMode}&count=10`, {
        headers: { 'Authorization': tg.initData }
      });
      questions = await response.json();
      currentQuestionIndex = 0;
      correctCount = 0;
      showScreen('game-screen');
      loadQuestion();
    } catch (e) {
      alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–æ–ø—Ä–æ—Å–æ–≤');
    }
  }

  function showScreen(screenId) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById(screenId).classList.add('active');
    
    if (screenId === 'level-screen') {
      document.querySelectorAll('.level-item').forEach(i => i.classList.remove('selected'));
      document.getElementById('start-btn').classList.remove('active');
      currentLevel = "";
      document.getElementById('start-btn').onclick = () => {
        if (currentLevel) fetchQuestions();
      };
    }
  }

  function loadQuestion() {
    if (currentQuestionIndex >= questions.length) {
      endGame();
      return;
    }

    const q = questions[currentQuestionIndex];
    document.getElementById('current').textContent = currentQuestionIndex + 1;
    document.getElementById('correct').textContent = correctCount;
    document.getElementById('result').textContent = '';

    document.getElementById('question-text').style.display = 'none';
    document.getElementById('flag-block').style.display = 'block';
    document.getElementById('options').innerHTML = '';
    document.getElementById('options').className = 'options-grid';

    if (gameMode === 'country-to-flag') {
      document.getElementById('question-text').textContent = q.text;
      document.getElementById('question-text').style.display = 'block';
      document.getElementById('flag-block').style.display = 'none';

      document.getElementById('options').classList.add(currentLevel);
      q.options.forEach(opt => {
        const btn = document.createElement('button');
        btn.className = 'btn flag-option';
        const img = document.createElement('img');
        img.src = opt.image_url;
        img.alt = "–§–ª–∞–≥";
        btn.appendChild(img);
        btn.onclick = () => submitAnswer(opt.image_url, q.correct_answer);
        document.getElementById('options').appendChild(btn);
      });
    } else {
      document.getElementById('loading').style.display = 'block';
      document.getElementById('flag').style.display = 'none';

      const flagImg = document.getElementById('flag');
      flagImg.onload = () => {
        document.getElementById('loading').style.display = 'none';
        flagImg.style.display = 'block';
      };
      flagImg.src = q.image_url;

      q.options.forEach(opt => {
        const btn = document.createElement('button');
        btn.className = 'btn';
        btn.textContent = opt;
        btn.onclick = () => submitAnswer(opt, q.correct_answer);
        document.getElementById('options').appendChild(btn);
      });
    }

    startTimer();
  }

  function startTimer() {
    timeLeft = 10;
    document.getElementById('timer-fill').style.width = '100%';
    clearInterval(timerInterval);
    timerInterval = setInterval(() => {
      timeLeft -= 0.1;
      const pct = Math.max(0, (timeLeft / 10) * 100);
      document.getElementById('timer-fill').style.width = pct + '%';
      if (timeLeft <= 0) {
        clearInterval(timerInterval);
        submitAnswer(null, questions[currentQuestionIndex].correct_answer);
      }
    }, 100);
  }

  function submitAnswer(answer, correctAnswer) {
    clearInterval(timerInterval);
    const buttons = document.querySelectorAll('.btn');
    buttons.forEach(btn => btn.disabled = true);

    const isCorrect = answer === correctAnswer;
    if (!answer) {
      document.getElementById('result').innerHTML = '‚è∞ –í—Ä–µ–º—è –≤—ã—à–ª–æ!';
    } else if (isCorrect) {
      correctCount++;
      document.getElementById('result').innerHTML = '‚úÖ –í–µ—Ä–Ω–æ!';
      if (gameMode !== 'country-to-flag') {
        document.getElementById('flag').classList.add('success');
        setTimeout(() => document.getElementById('flag').classList.remove('success'), 800);
      }
    } else {
      document.getElementById('result').innerHTML = '‚ùå –ù–µ–≤–µ—Ä–Ω–æ!';
    }

    buttons.forEach(btn => {
      if (gameMode === 'country-to-flag') {
        const img = btn.querySelector('img');
        if (img && img.src === correctAnswer) btn.classList.add('correct');
        if (img && img.src === answer && !isCorrect) btn.classList.add('incorrect');
      } else {
        if (btn.textContent === correctAnswer) btn.classList.add('correct');
        if (btn.textContent === answer && !isCorrect) btn.classList.add('incorrect');
      }
    });

    setTimeout(() => {
      currentQuestionIndex++;
      if (currentQuestionIndex < questions.length) {
        loadQuestion();
      } else {
        endGame();
      }
    }, 2500);
  }

  function endGame() {
    document.getElementById('final-correct').textContent = correctCount;
    const messageEl = document.getElementById('final-message');
    
    if (correctCount === 10) {
      messageEl.innerHTML = 'üéâ –ò–¥–µ–∞–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç!';
    } else if (correctCount >= 7) {
      messageEl.innerHTML = 'üëç –û—Ç–ª–∏—á–Ω–æ!';
    } else if (correctCount >= 5) {
      messageEl.innerHTML = 'üôÇ –ù–µ–ø–ª–æ—Ö–æ!';
    } else {
      messageEl.innerHTML = 'ü§î –ú–æ–∂–Ω–æ –ª—É—á—à–µ!';
    }
    
    showScreen('final-screen');
  }

  function restartGame() {
    showScreen('main-screen');
  }

  document.getElementById('start-btn').onclick = () => {
    if (currentLevel) fetchQuestions();
  };
</script>
</body>
</html>
