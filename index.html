<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>üåç Guess Globe</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  
  <!-- –§–æ–Ω–æ–≤–∞—è –º—É–∑—ã–∫–∞ -->
  <audio id="bg-music" loop preload="auto">
    <source src="https://cdn.jsdelivr.net/gh/lisofoxa-oss/guess-globe-assets@main/Next_to_You.mp3" type="audio/mpeg">
  </audio>
  
<style>
  * {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
    font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
  }

  html, body {
    height: 100%;
    overflow: hidden;
  }

  body {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: stretch;
    padding: env(safe-area-inset-top) 12px env(safe-area-inset-bottom) 12px;
    max-height: 100vh;
    color: #f5f5ff;
    transition: background 0.4s ease;
  }

  .container {
    position: relative;
    flex: 0 0 auto;
    max-width: 480px;
    width: 100%;
    margin: 0 auto;
    border-radius: 24px;
    padding: 18px 16px 20px;
    overflow: hidden;
  }

  .screen {
    display: none;
    flex-direction: column;
    flex: 1;
  }

  .screen.active {
    display: flex;
  }

  .close-btn {
    position: absolute;
    top: 10px;
    right: 10px;
    width: 32px;
    height: 32px;
    border: none;
    border-radius: 999px;
    font-size: 16px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10;
  }

  .music-toggle {
    position: absolute;
    bottom: 12px;
    right: 12px;
    width: 36px;
    height: 36px;
    border: none;
    border-radius: 999px;
    font-size: 14px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10;
  }

  /* –í–µ—Ä—Ö–Ω–∏–π –±–∞—Ä / –ª–æ–≥–æ—Ç–∏–ø */
  .top-bar {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 12px;
  }

  .logo-mark {
    width: 32px;
    height: 32px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
  }

  .title-block {
    display: flex;
    flex-direction: column;
    gap: 2px;
  }

  .title-main {
    font-size: 18px;
    font-weight: 700;
    letter-spacing: 0.03em;
  }

  .title-sub {
    font-size: 12px;
    opacity: 0.7;
  }

  .version-label {
    margin-top: 6px;
    text-align: center;
    font-size: 11px;
    opacity: 0.5;
  }

  /* –ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω */
  .mode-btn {
    padding: 14px;
    margin: 8px 0;
    border-radius: 16px;
    border: 1px solid transparent;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: space-between;
    transition: transform 0.08s ease, box-shadow 0.12s ease, background 0.15s ease, border-color 0.15s ease;
  }

  .mode-btn span.subtitle {
    font-size: 12px;
    opacity: 0.7;
  }

  .mode-btn:active {
    transform: scale(0.97);
  }

  /* –í—ã–±–æ—Ä —É—Ä–æ–≤–Ω—è */
  .level-item {
    padding: 14px 12px;
    margin: 8px 0;
    border-radius: 16px;
    cursor: pointer;
    transition: transform 0.08s ease, box-shadow 0.12s ease, background 0.15s ease, border-color 0.15s ease;
    border: 1px solid transparent;
  }

  .level-item:active {
    transform: scale(0.98);
  }

  .level-title {
    font-size: 16px;
    font-weight: 700;
    margin-bottom: 4px;
  }

  .level-desc {
    font-size: 13px;
    opacity: 0.85;
  }

  .start-btn {
    padding: 14px 16px;
    margin: 14px 0 0;
    border-radius: 999px;
    border: none;
    font-size: 16px;
    font-weight: 700;
    cursor: pointer;
    width: 100%;
    max-width: 320px;
    align-self: flex-start;
    opacity: 0.6;
    pointer-events: none;
    transition: opacity 0.15s ease, box-shadow 0.12s ease, transform 0.08s ease;
  }

  .start-btn.active {
    opacity: 1;
    pointer-events: auto;
  }

  .start-btn:active {
    transform: scale(0.97);
  }

  /* –ò–≥—Ä–æ–≤–æ–π —ç–∫—Ä–∞–Ω */
  .progress {
    text-align: left;
    font-size: 12px;
    margin-bottom: 4px;
    font-weight: 600;
    opacity: 0.8;
  }

  .stats {
    display: flex;
    justify-content: space-between;
    padding: 6px 10px;
    border-radius: 999px;
    font-size: 11px;
    font-weight: 600;
    margin-bottom: 10px;
  }

  #question-text {
    text-align: center;
    font-size: 21px;
    font-weight: 700;
    margin: 4px 0 10px;
  }

  .flag-container {
    position: relative;
    margin: 8px 0 12px;
    padding: 14px;
    border-radius: 18px;
    min-height: 140px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .loading {
    text-align: center;
    font-size: 15px;
    opacity: 0.8;
    width: 100%;
  }

  .flag {
    max-width: 100%;
    max-height: 110px;
    object-fit: contain;
    border-radius: 10px;
    display: none;
  }

  @keyframes glow {
    0%, 100% { box-shadow: 0 0 8px rgba(76, 175, 80, 0.7); }
    50% { box-shadow: 0 0 20px rgba(129, 199, 132, 1); }
  }

  @keyframes glow-red {
    0%, 100% { box-shadow: 0 0 8px rgba(244, 67, 54, 0.8); }
    50% { box-shadow: 0 0 20px rgba(239, 83, 80, 1); }
  }

  .flag.success {
    animation: glow 0.8s ease-in-out;
  }

  .flag.error {
    animation: glow-red 0.8s ease-in-out;
  }

  .timer-bar {
    height: 5px;
    border-radius: 999px;
    overflow: hidden;
    margin: 6px 0 8px;
  }

  .timer-fill {
    height: 100%;
    width: 100%;
    transition: width 0.1s linear;
  }

  #options {
    flex: 1;
    overflow-y: auto;
    margin: 6px 0 4px;
    padding-right: 2px;
  }

  .btn {
    width: 100%;
    padding: 12px 14px;
    margin: 6px 0;
    border-radius: 999px;
    border: 1px solid transparent;
    font-size: 15px;
    font-weight: 600;
    cursor: pointer;
    text-align: left;
    display: flex;
    align-items: center;
    justify-content: space-between;
    transition: transform 0.08s ease, box-shadow 0.12s ease, background 0.15s ease, border-color 0.15s ease;
  }

  .btn span.badge {
    font-size: 11px;
    opacity: 0.7;
  }

  .btn:disabled {
    cursor: default;
    opacity: 0.85;
  }

  .btn:active:not(:disabled) {
    transform: scale(0.97);
  }

  .btn.correct { }
  .btn.incorrect { }

  .options-grid {
    display: grid;
    gap: 10px;
    margin: 10px 0;
  }

  .options-grid.easy { grid-template-columns: repeat(2, 1fr); }

  .options-grid.medium { grid-template-columns: repeat(2, 1fr); }

  .options-grid.medium .btn:nth-child(5) { grid-column: span 2; }

  .options-grid.hard { grid-template-columns: repeat(3, 1fr); }

  .btn.flag-option {
    padding: 6px;
    border-radius: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .btn.flag-option img {
    width: 100%;
    max-height: 72px;
    border-radius: 10px;
    object-fit: cover;
  }

  #result {
    text-align: center;
    min-height: 22px;
    font-size: 14px;
    font-weight: 600;
    margin-top: 4px;
  }

  /* –§–∏–Ω–∞–ª—å–Ω—ã–π —ç–∫—Ä–∞–Ω */
  .final-screen h2 {
    font-size: 22px;
    margin-top: 10px;
    margin-bottom: 8px;
    text-align: center;
  }

  .final-score {
    font-size: 46px;
    font-weight: 800;
    margin: 10px 0 6px;
    text-align: center;
  }

  #final-message {
    font-size: 14px;
    opacity: 0.85;
    text-align: center;
  }

  .restart-btn {
    padding: 14px 16px;
    margin-top: 18px;
    border-radius: 999px;
    border: none;
    font-size: 16px;
    font-weight: 700;
    cursor: pointer;
    width: 100%;
    transition: transform 0.08s ease, box-shadow 0.12s ease;
  }

  .restart-btn:active {
    transform: scale(0.97);
  }

  /* –ö–æ–Ω—Ñ–µ—Ç—Ç–∏ */
  #confetti {
    position: fixed;
    inset: 0;
    pointer-events: none;
    z-index: 1000;
    display: none;
  }

  /* –°–∫—Ä—ã—Ç–∏–µ —Å–∫—Ä–æ–ª–ª–±–∞—Ä–æ–≤ (–º—è–≥–∫–æ) */
  #options::-webkit-scrollbar {
    width: 4px;
  }

  #options::-webkit-scrollbar-thumb {
    border-radius: 999px;
  }
  /* === –¢–ï–ú–ê 1: –ß–Å–†–ù–´–ô –ù–ï–û–ù === */

body.theme-dark {
  background:
    radial-gradient(circle at 0% 0%, rgba(76, 175, 80, 0.28), transparent 55%),
    radial-gradient(circle at 100% 100%, rgba(156, 39, 176, 0.32), transparent 55%),
    linear-gradient(135deg, #050816, #0b1020);
}

body.theme-dark .container {
  background: rgba(10, 14, 35, 0.82);
  border: 1px solid rgba(255, 255, 255, 0.06);
  box-shadow:
    0 18px 45px rgba(0, 0, 0, 0.9),
    0 0 0 1px rgba(255, 255, 255, 0.03);
  backdrop-filter: blur(24px) saturate(135%);
}

body.theme-dark .close-btn,
body.theme-dark .music-toggle {
  background: rgba(12, 20, 40, 0.9);
  color: #f5f5ff;
  box-shadow: 0 0 12px rgba(0, 0, 0, 0.8);
  border: 1px solid rgba(255, 255, 255, 0.12);
}

body.theme-dark .logo-mark {
  background: radial-gradient(circle at 30% 30%, #8bc34a, #4caf50);
  box-shadow: 0 0 16px rgba(139, 195, 74, 0.8);
}

body.theme-dark .title-main {
  color: #ffffff;
}

body.theme-dark .title-sub {
  color: #cfd8ff;
}

/* –ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω ‚Äì –∫–Ω–æ–ø–∫–∏ —Ä–µ–∂–∏–º–æ–≤ */
body.theme-dark .mode-btn {
  background: radial-gradient(circle at 0 0, rgba(255,255,255,0.18), rgba(15, 23, 42, 0.95));
  border-color: rgba(255, 255, 255, 0.16);
  color: #f5f5ff;
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.85);
}

body.theme-dark .mode-btn:hover {
  box-shadow: 0 12px 30px rgba(76, 175, 80, 0.5);
  border-color: rgba(129, 199, 132, 0.85);
}

/* –£—Ä–æ–≤–Ω–∏ */
body.theme-dark .level-item {
  background: rgba(15, 23, 42, 0.92);
  border-color: rgba(255, 255, 255, 0.12);
  color: #f5f5ff;
  box-shadow: 0 8px 22px rgba(0, 0, 0, 0.8);
}

body.theme-dark .level-item.selected.easy {
  border-color: rgba(76, 175, 80, 0.9);
  box-shadow: 0 0 18px rgba(76, 175, 80, 0.85);
}

body.theme-dark .level-item.selected.medium {
  border-color: rgba(255, 193, 7, 0.9);
  box-shadow: 0 0 18px rgba(255, 193, 7, 0.85);
}

body.theme-dark .level-item.selected.hard {
  border-color: rgba(244, 67, 54, 0.95);
  box-shadow: 0 0 20px rgba(244, 67, 54, 0.9);
}

body.theme-dark .start-btn {
  background: linear-gradient(135deg, #4caf50, #81c784);
  color: #0b1020;
  box-shadow: 0 12px 28px rgba(76, 175, 80, 0.7);
}

/* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞, –≤–æ–ø—Ä–æ—Å, —Ñ–ª–∞–≥ */
body.theme-dark .stats {
  background: rgba(15, 23, 42, 0.92);
  border: 1px solid rgba(255, 255, 255, 0.08);
  color: #c5cae9;
}

body.theme-dark .flag-container {
  background: radial-gradient(circle at 30% 0%, rgba(255,255,255,0.18), rgba(10, 14, 35, 0.98));
  border: 1px solid rgba(255, 255, 255, 0.16);
  box-shadow:
    0 12px 28px rgba(0, 0, 0, 0.9),
    0 0 0 1px rgba(0, 0, 0, 0.5);
}

body.theme-dark .flag {
  filter: drop-shadow(0 8px 16px rgba(0,0,0,0.85));
}

/* –¢–∞–π–º–µ—Ä */
body.theme-dark .timer-bar {
  background: rgba(255, 255, 255, 0.05);
}

body.theme-dark .timer-fill {
  background: linear-gradient(90deg, #4caf50, #ffeb3b, #f44336);
  background-size: 200% 100%;
  box-shadow: 0 0 12px rgba(255, 255, 255, 0.4);
}

/* –¢–µ–∫—Å—Ç–æ–≤—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã */
body.theme-dark .btn {
  background: radial-gradient(circle at 0 0, rgba(255,255,255,0.12), rgba(15, 23, 42, 0.98));
  border-color: rgba(255, 255, 255, 0.12);
  color: #f5f5ff;
  box-shadow: 0 10px 24px rgba(0,0,0,0.9);
}

body.theme-dark .btn:hover:not(:disabled) {
  box-shadow: 0 14px 30px rgba(76, 175, 80, 0.4);
}

/* –§–ª–∞–≥–æ–≤—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã */
body.theme-dark .btn.flag-option {
  background: radial-gradient(circle at 0 0, rgba(255,255,255,0.16), rgba(15, 23, 42, 0.98));
  border-color: rgba(255, 255, 255, 0.16);
  box-shadow: 0 10px 26px rgba(0,0,0,0.9);
}

body.theme-dark .btn.flag-option:hover:not(:disabled) {
  box-shadow: 0 14px 32px rgba(139, 195, 74, 0.6);
}

/* –°–æ—Å—Ç–æ—è–Ω–∏—è –æ—Ç–≤–µ—Ç–æ–≤ */
body.theme-dark .btn.correct {
  background: linear-gradient(135deg, #2e7d32, #43a047) !important;
  border-color: rgba(129, 199, 132, 0.95) !important;
  box-shadow: 0 0 22px rgba(129, 199, 132, 1);
  color: #e8f5e9 !important;
}

body.theme-dark .btn.incorrect {
  background: linear-gradient(135deg, #c62828, #e53935) !important;
  border-color: rgba(244, 67, 54, 0.98) !important;
  box-shadow: 0 0 22px rgba(244, 67, 54, 1);
  color: #ffebee !important;
}

/* –§–∏–Ω–∞–ª—å–Ω—ã–π —ç–∫—Ä–∞–Ω */
body.theme-dark .restart-btn {
  background: linear-gradient(135deg, #4caf50, #81c784);
  color: #0b1020;
  box-shadow: 0 12px 30px rgba(76, 175, 80, 0.8);
}

/* –°–∫—Ä–æ–ª–ª–±–∞—Ä */
body.theme-dark #options::-webkit-scrollbar-thumb {
  background: rgba(129, 199, 132, 0.8);
}
/* === –¢–ï–ú–ê 2: –°–í–ï–¢–õ–ê–Ø –ö–ê–†–¢–û–ß–ù–ê–Ø (–ø–æ—Ö–æ–∂–∞ –Ω–∞ —Ç–≤–æ—é —Ç–µ–∫—É—â—É—é) === */

body.theme-light {
  background:
    radial-gradient(circle at 0% 0%, rgba(129, 199, 132, 0.4), transparent 55%),
    radial-gradient(circle at 100% 100%, rgba(255, 235, 59, 0.35), transparent 55%),
    linear-gradient(145deg, #4caf50, #8bc34a);
}

body.theme-light .container {
  background: rgba(255, 255, 255, 0.12);
  border: 1px solid rgba(255, 255, 255, 0.22);
  box-shadow:
    0 16px 40px rgba(0, 0, 0, 0.55);
  backdrop-filter: blur(18px) saturate(130%);
  color: #ffffff;
}

body.theme-light .close-btn,
body.theme-light .music-toggle {
  background: rgba(255, 255, 255, 0.18);
  color: #ffffff;
  border: 1px solid rgba(255, 255, 255, 0.32);
  box-shadow: 0 8px 18px rgba(0, 0, 0, 0.5);
}

body.theme-light .logo-mark {
  background: radial-gradient(circle at 30% 30%, #ffffff, #c5e1a5);
  color: #33691e;
  box-shadow: 0 0 14px rgba(200, 230, 201, 0.9);
}

body.theme-light .title-main {
  color: #ffffff;
}

body.theme-light .title-sub {
  color: #e8f5e9;
}

body.theme-light .mode-btn {
  background: rgba(255, 255, 255, 0.96);
  border-color: rgba(255, 255, 255, 0.9);
  color: #1b5e20;
  box-shadow: 0 8px 20px rgba(56, 142, 60, 0.35);
}

body.theme-light .mode-btn:hover {
  box-shadow: 0 10px 24px rgba(56, 142, 60, 0.55);
}

/* –£—Ä–æ–≤–Ω–∏ */
body.theme-light .level-item {
  background: rgba(0, 0, 0, 0.18);
  border-color: rgba(255, 255, 255, 0.32);
  color: #ffffff;
}

body.theme-light .level-item.selected.easy {
  background: rgba(76, 175, 80, 0.25);
  border-color: #4caf50;
  box-shadow: 0 0 14px rgba(76, 175, 80, 0.7);
}

body.theme-light .level-item.selected.medium {
  background: rgba(255, 193, 7, 0.25);
  border-color: #ffc107;
  box-shadow: 0 0 14px rgba(255, 193, 7, 0.7);
}

body.theme-light .level-item.selected.hard {
  background: rgba(244, 67, 54, 0.25);
  border-color: #f44336;
  box-shadow: 0 0 14px rgba(244, 67, 54, 0.7);
}

body.theme-light .start-btn {
  background: #4caf50;
  color: #ffffff;
  box-shadow: 0 10px 24px rgba(56, 142, 60, 0.6);
}

/* –ò–≥—Ä–æ–≤–æ–π —ç–∫—Ä–∞–Ω */
body.theme-light .stats {
  background: rgba(0, 0, 0, 0.25);
  border: 1px solid rgba(255, 255, 255, 0.28);
  color: #e8f5e9;
}

body.theme-light .flag-container {
  background: rgba(255, 255, 255, 0.16);
  border: 2px dashed rgba(255, 255, 255, 0.55);
  box-shadow: 0 10px 26px rgba(0,0,0,0.55);
}

body.theme-light .flag {
  filter: drop-shadow(0 6px 12px rgba(0,0,0,0.55));
}

/* –¢–∞–π–º–µ—Ä */
body.theme-light .timer-bar {
  background: rgba(255, 255, 255, 0.32);
}

body.theme-light .timer-fill {
  background: linear-gradient(90deg, #4caf50, #ffeb3b, #f44336);
  background-size: 200% 100%;
}

/* –ö–Ω–æ–ø–∫–∏ –æ—Ç–≤–µ—Ç–æ–≤ */
body.theme-light .btn {
  background: rgba(255, 255, 255, 0.95);
  border-color: rgba(255, 255, 255, 0.9);
  color: #263238;
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.35);
}

body.theme-light .btn.flag-option {
  background: rgba(255, 255, 255, 0.9);
  border-color: rgba(255, 255, 255, 0.9);
}

/* –°–æ—Å—Ç–æ—è–Ω–∏—è */
body.theme-light .btn.correct {
  background: #4caf50 !important;
  border-color: #66bb6a !important;
  color: #ffffff !important;
  box-shadow: 0 0 16px rgba(102, 187, 106, 1);
}

body.theme-light .btn.incorrect {
  background: #f44336 !important;
  border-color: #ef5350 !important;
  color: #ffffff !important;
  box-shadow: 0 0 16px rgba(239, 83, 80, 1);
}

/* –§–∏–Ω–∞–ª—å–Ω—ã–π —ç–∫—Ä–∞–Ω */
body.theme-light .restart-btn {
  background: #4caf50;
  color: #ffffff;
  box-shadow: 0 10px 24px rgba(56, 142, 60, 0.65);
}

body.theme-light #options::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.75);
}

</style>

</head>
<body class="theme-dark">
  <div id="main-screen" class="screen active">
    <div class="top-bar">
      <div class="logo-mark">üåç</div>
      <div class="title-block">
        <div class="title-main">Guess Globe</div>
        <div class="title-sub">–£–≥–∞–¥–∞–π —Ñ–ª–∞–≥ —Å—Ç—Ä–∞–Ω—ã</div>
      </div>
    </div>
  
    <button class="mode-btn" onclick="startGame('flag-to-country')">
      <span>üè≥Ô∏è –§–ª–∞–≥ ‚Üí –°—Ç—Ä–∞–Ω–∞?</span>
      <span class="subtitle">–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π —Ä–µ–∂–∏–º</span>
    </button>
  
    <button class="mode-btn" onclick="startGame('country-to-flag')">
      <span>üåç –°—Ç—Ä–∞–Ω–∞ ‚Üí –§–ª–∞–≥?</span>
      <span class="subtitle">–ù–∞–æ–±–æ—Ä–æ—Ç, —Å–ª–æ–∂–Ω–µ–µ</span>
    </button>
  
    <div class="version-label">v1.2.4</div>
  </div>

    <!-- –í—ã–±–æ—Ä —É—Ä–æ–≤–Ω—è -->
    <div id="level-screen" class="screen">
      <h1>–í—ã–±–µ—Ä–∏ —É—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏</h1>
      
      <div class="level-item" data-level="easy">
        <div class="level-title">üü¢ –õ—ë–≥–∫–∏–π</div>
        <div class="level-desc">30 —Å–∞–º—ã—Ö —É–∑–Ω–∞–≤–∞–µ–º—ã—Ö —Ñ–ª–∞–≥–æ–≤<br>–í—ã–±–æ—Ä –∏–∑ 4 —Å—Ç—Ä–∞–Ω</div>
      </div>
      
      <div class="level-item" data-level="medium">
        <div class="level-title">üü° –°—Ä–µ–¥–Ω–∏–π</div>
        <div class="level-desc">100 —Å—Ç—Ä–∞–Ω –º–∏—Ä–∞<br>–í—ã–±–æ—Ä –∏–∑ 5 —Å—Ç—Ä–∞–Ω</div>
      </div>
      
      <div class="level-item" data-level="hard">
        <div class="level-title">üî¥ –°–ª–æ–∂–Ω—ã–π</div>
        <div class="level-desc">–í—Å–µ 195 —Å—Ç—Ä–∞–Ω –û–û–ù<br>–í—ã–±–æ—Ä –∏–∑ 6 —Å—Ç—Ä–∞–Ω</div>
      </div>
      
      <button class="start-btn" id="start-btn">‚ñ∂Ô∏è –ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
    </div>

    <!-- –ò–≥—Ä–æ–≤–æ–π —ç–∫—Ä–∞–Ω -->
    <div id="game-screen" class="screen">
      <div class="progress">–í–æ–ø—Ä–æ—Å <span id="current">1</span> –∏–∑ 10</div>
      <div class="stats">
        <div>‚úÖ –í–µ—Ä–Ω–æ: <span id="correct">0</span></div>
      </div>

      <!-- –¢–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–∞ (–¥–ª—è —Ä–µ–∂–∏–º–∞ –°—Ç—Ä–∞–Ω–∞ ‚Üí –§–ª–∞–≥) -->
      <div id="question-text" style="text-align: center; font-size: 20px; margin: 12px 0; display: none;"></div>

      <!-- –ë–ª–æ–∫ —Ñ–ª–∞–≥–∞ (—Ç–æ–ª—å–∫–æ –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ —Ä–µ–∂–∏–º–∞) -->
      <div id="flag-block" style="display: block;">
        <div class="flag-container">
          <div id="loading" class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
          <img id="flag" class="flag" alt="–§–ª–∞–≥ —Å—Ç—Ä–∞–Ω—ã">
        </div>
      </div>

      <div class="timer-bar">
        <div id="timer-fill" class="timer-fill"></div>
      </div>

      <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ -->
      <div id="options" class="options-grid"></div>
      <div id="result"></div>
    </div>

    <!-- –§–∏–Ω–∞–ª—å–Ω—ã–π —ç–∫—Ä–∞–Ω -->
    <div id="final-screen" class="screen">
      <h2>–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞!</h2>
      <div class="final-score"><span id="final-correct">0</span>/10</div>
      <div id="final-message"></div>
      <button class="restart-btn" onclick="restartGame()">–ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
    </div>

    <button class="close-btn" onclick="window.Telegram.WebApp.close()">‚úï</button>
    <button class="music-toggle" id="music-toggle" onclick="toggleMusic()">‚ô™</button>
  </div>

  <!-- –ö–æ–Ω—Ñ–µ—Ç—Ç–∏ -->
  <div id="confetti"></div>

  <script>
    const tg = window.Telegram.WebApp;
    tg.expand();
    tg.ready();

    let currentLevel = "";
    let gameMode = "";
    let questions = [];
    let currentQuestionIndex = 0;
    let correctCount = 0;
    let timeLeft = 10;
    let timerInterval;

    // –ú—É–∑—ã–∫–∞
    function toggleMusic() {
      const bgMusic = document.getElementById('bg-music');
      const btn = document.getElementById('music-toggle');
      
      if (bgMusic.paused) {
        bgMusic.play().catch(e => console.log("Autoplay blocked"));
        btn.textContent = 'üîá';
      } else {
        bgMusic.pause();
        btn.textContent = '‚ô™';
      }
    }

    document.addEventListener('click', () => {
      const bgMusic = document.getElementById('bg-music');
      if (bgMusic.paused) {
        bgMusic.muted = true;
        bgMusic.play().then(() => {
          bgMusic.pause();
          bgMusic.muted = false;
        }).catch(() => {});
      }
    }, { once: true });

    // –ó–≤—É–∫–∏ –æ—Ç–≤–µ—Ç–æ–≤
    function playSound(type) {
      try {
        const ctx = new (window.AudioContext || window.webkitAudioContext)();
        const osc = ctx.createOscillator();
        const gain = ctx.createGain();
        
        const now = ctx.currentTime;
        gain.gain.setValueAtTime(0, now);
        gain.gain.linearRampToValueAtTime(type === "correct" ? 0.12 : 0.22, now + 0.05);
        gain.gain.linearRampToValueAtTime(0, now + 0.4);
        
        osc.connect(gain);
        gain.connect(ctx.destination);
        
        if (type === "correct") {
          osc.frequency.setValueAtTime(659.25, now);
          osc.frequency.exponentialRampToValueAtTime(783.99, now + 0.3);
        } else {
          osc.frequency.setValueAtTime(349.23, now);
          osc.frequency.exponentialRampToValueAtTime(261.63, now + 0.3);
        }
        
        osc.type = "sine";
        osc.start(now);
        osc.stop(now + 0.4);
        
        setTimeout(() => { if (ctx.state !== 'closed') ctx.close(); }, 500);
      } catch (e) {}
    }

    // –ö–æ–Ω—Ñ–µ—Ç—Ç–∏
    function createConfetti() {
      const confettiContainer = document.getElementById('confetti');
      confettiContainer.innerHTML = '';
      confettiContainer.style.display = 'block';
      
      const colors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff'];
      const width = window.innerWidth;
      const height = window.innerHeight;
      
      for (let i = 0; i < 150; i++) {
        const piece = document.createElement('div');
        piece.style.position = 'absolute';
        piece.style.width = Math.random() * 10 + 5 + 'px';
        piece.style.height = piece.style.width;
        piece.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
        piece.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
        piece.style.top = '-10px';
        piece.style.left = Math.random() * width + 'px';
        piece.style.opacity = Math.random() * 0.8 + 0.2;
        piece.style.transform = `rotate(${Math.random() * 360}deg)`;
        
        confettiContainer.appendChild(piece);
        
        const duration = Math.random() * 3 + 2;
        const delay = Math.random() * 2;
        piece.animate([
          { top: '-10px', transform: 'rotate(0deg)' },
          { top: `${height}px`, transform: `rotate(${Math.random() * 720}deg)` }
        ], {
          duration: duration * 1000,
          delay: delay * 1000,
          easing: 'cubic-bezier(0.1, 0.8, 0.2, 1)'
        });
      }
      
      setTimeout(() => { confettiContainer.style.display = 'none'; }, 5000);
    }

    // –ù–∞—á–∞–ª–æ –∏–≥—Ä—ã
    function startGame(mode) {
      gameMode = mode;
      showScreen('level-screen');
      
      document.querySelectorAll('.level-item').forEach(item => {
        item.addEventListener('click', () => {
          document.querySelectorAll('.level-item').forEach(i => {
            i.classList.remove('selected', 'easy', 'medium', 'hard');
          });
          item.classList.add('selected', item.dataset.level);
          currentLevel = item.dataset.level;
          document.getElementById('start-btn').classList.add('active');
        });
      });
      
      document.getElementById('start-btn').onclick = () => {
        if (currentLevel) {
          fetchQuestions();
        }
      };
    }

    async function fetchQuestions() {
      try {
        const response = await fetch(`https://guess-globe-backend.onrender.com/api/questions?level=${currentLevel}&mode=${gameMode}&count=10`, {
          headers: { 'Authorization': tg.initData }
        });
        questions = await response.json();
        currentQuestionIndex = 0;
        correctCount = 0;
        showScreen('game-screen');
        loadQuestion();
      } catch (e) {
        alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–æ–ø—Ä–æ—Å–æ–≤');
      }
    }

    function showScreen(screenId) {
      document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
      document.getElementById(screenId).classList.add('active');
      
      if (screenId === 'level-screen') {
        document.querySelectorAll('.level-item').forEach(i => i.classList.remove('selected', 'easy', 'medium', 'hard'));
        document.getElementById('start-btn').classList.remove('active');
        currentLevel = "";
      } else if (screenId === 'game-screen') {
        updateBackground(currentLevel);
      }
    }

    function updateBackground(level) {
      const body = document.body;
      if (level === "easy") {
        body.style.background = "linear-gradient(135deg, #4CAF50, #8BC34A)";
      } else if (level === "medium") {
        body.style.background = "linear-gradient(135deg, #FF9800, #FFC107)";
      } else {
        body.style.background = "linear-gradient(135deg, #F44336, #E91E63)";
      }
    }

    function loadQuestion() {
      if (currentQuestionIndex >= questions.length) {
        endGame();
        return;
      }
      
      const q = questions[currentQuestionIndex];
      document.getElementById('current').textContent = currentQuestionIndex + 1;
      document.getElementById('correct').textContent = correctCount;
      document.getElementById('result').textContent = '';

      // –°–∫—Ä—ã—Ç—å –≤—Å—ë
      document.getElementById('question-text').style.display = 'none';
      document.getElementById('flag-block').style.display = 'block';
      document.getElementById('options').innerHTML = '';
      document.getElementById('options').className = 'options-grid';

      if (gameMode === 'country-to-flag') {
        document.getElementById('question-text').textContent = q.text;
        document.getElementById('question-text').style.display = 'block';
        document.getElementById('flag-block').style.display = 'none';

        const optionsDiv = document.getElementById('options');
        optionsDiv.classList.add(currentLevel);

        q.options.forEach(opt => {
          const btn = document.createElement('button');
          btn.className = 'btn flag-option';
          const img = document.createElement('img');
          img.src = opt.image_url;
          img.alt = "–§–ª–∞–≥";
          btn.appendChild(img);
          btn.onclick = () => submitAnswer(opt.image_url, q.correct_answer);
          optionsDiv.appendChild(btn);
        });
      } else {
        document.getElementById('loading').style.display = 'block';
        document.getElementById('flag').style.display = 'none';

        const flagImg = document.getElementById('flag');
        flagImg.onload = () => {
          document.getElementById('loading').style.display = 'none';
          flagImg.style.display = 'block';
        };
        flagImg.src = q.image_url;

        const optionsDiv = document.getElementById('options');
        q.options.forEach(opt => {
          const btn = document.createElement('button');
          btn.className = 'btn';
          btn.textContent = opt;
          btn.onclick = () => submitAnswer(opt, q.correct_answer);
          optionsDiv.appendChild(btn);
        });
      }

      startTimer();
    }

    function startTimer() {
      timeLeft = 10;
      document.getElementById('timer-fill').style.width = '100%';
      clearInterval(timerInterval);
      timerInterval = setInterval(() => {
        timeLeft -= 0.1;
        const pct = Math.max(0, (timeLeft / 10) * 100);
        document.getElementById('timer-fill').style.width = pct + '%';
        if (timeLeft <= 0) {
          clearInterval(timerInterval);
          submitAnswer(null, questions[currentQuestionIndex].correct_answer);
        }
      }, 100);
    }

    function submitAnswer(answer, correctAnswer) {
      clearInterval(timerInterval);
      const buttons = document.querySelectorAll('.btn');
      buttons.forEach(btn => btn.disabled = true);

      let isCorrect = false;
      if (answer === null) {
        document.getElementById('result').innerHTML = '‚è∞ –í—Ä–µ–º—è –≤—ã—à–ª–æ!';
        playSound("wrong");
      } else {
        isCorrect = answer === correctAnswer;
        if (isCorrect) {
          correctCount++;
          playSound("correct");
          document.getElementById('result').innerHTML = '‚úÖ –í–µ—Ä–Ω–æ!';
          
          if (gameMode !== 'country-to-flag') {
            const flagEl = document.getElementById('flag');
            flagEl.classList.add('success');
            setTimeout(() => { flagEl.classList.remove('success'); }, 800);
          }
          
          buttons.forEach(btn => {
            if (gameMode === 'country-to-flag') {
              const img = btn.querySelector('img');
              if (img && img.src === correctAnswer) {
                btn.classList.add('correct');
              }
            } else {
              if (btn.textContent === correctAnswer) {
                btn.classList.add('correct');
              }
            }
          });
        } else {
          playSound("wrong");
          document.getElementById('result').innerHTML = '‚ùå –ù–µ–≤–µ—Ä–Ω–æ';
          
          buttons.forEach(btn => {
            if (gameMode === 'country-to-flag') {
              const img = btn.querySelector('img');
              if (img && img.src === answer) {
                btn.classList.add('incorrect');
              }
              if (img && img.src === correctAnswer) {
                btn.classList.add('correct');
              }
            } else {
              if (btn.textContent === answer) {
                btn.classList.add('incorrect');
              }
              if (btn.textContent === correctAnswer) {
                btn.classList.add('correct');
              }
            }
          });
        }
      }

      setTimeout(() => {
        currentQuestionIndex++;
        if (currentQuestionIndex < questions.length) {
          loadQuestion();
        } else {
          endGame();
        }
      }, 2500);
    }

    function endGame() {
      document.getElementById('final-correct').textContent = correctCount;
      const messageEl = document.getElementById('final-message');
      
      if (correctCount === 10) {
        messageEl.innerHTML = 'üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –ò–¥–µ–∞–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç!';
        createConfetti();
      } else if (correctCount >= 7) {
        messageEl.innerHTML = 'üëç –û—Ç–ª–∏—á–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç!';
      } else if (correctCount >= 5) {
        messageEl.innerHTML = 'üôÇ –ù–µ–ø–ª–æ—Ö–æ!';
      } else {
        messageEl.innerHTML = 'ü§î –ü–æ–ø—Ä–æ–±—É–π –µ—â—ë —Ä–∞–∑!';
      }
      
      showScreen('final-screen');
    }

    function restartGame() {
      showScreen('main-screen');
    }

    // –í —Å–∞–º–æ–º –∫–æ–Ω—Ü–µ —Å–∫—Ä–∏–ø—Ç–∞ (–ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã–≤–∞—é—â–∏–º
    document.addEventListener('DOMContentLoaded', () => {
      // –ü—ã—Ç–∞–µ–º—Å—è –≤–∫–ª—é—á–∏—Ç—å –º—É–∑—ã–∫—É –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è
      const bgMusic = document.getElementById('bg-music');
      bgMusic.volume = 0.3; // —á—É—Ç—å —Ç–∏—à–µ
      
      // –ü–µ—Ä–≤—ã–π –∫–ª–∏–∫ ‚Äî —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ
      function enableAudio() {
        bgMusic.muted = true;
        bgMusic.play().then(() => {
          bgMusic.pause();
          bgMusic.muted = false;
          // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–∫–ª—é—á–∞–µ–º –º—É–∑—ã–∫—É
          bgMusic.play().catch(() => {});
          document.getElementById('music-toggle').textContent = 'üîá';
        }).catch(() => {});
        
        document.removeEventListener('click', enableAudio);
        document.removeEventListener('touchstart', enableAudio);
      }
      
      document.addEventListener('click', enableAudio);
      document.addEventListener('touchstart', enableAudio);
    });
  </script>
</body>
</html>
