<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>üåç Guess Globe</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  
  <!-- –§–æ–Ω–æ–≤–∞—è –º—É–∑—ã–∫–∞ -->
  <audio id="bg-music" loop preload="auto">
    <source src="https://cdn.jsdelivr.net/gh/lisofoxa-oss/guess-globe-assets@main/Next_to_You.mp3" type="audio/mpeg">
  </audio>
  
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    }
    html, body {
      height: 100%;
      overflow: hidden;
    }
    body {
      background: linear-gradient(135deg, #4CAF50, #8BC34A);
      transition: background 0.5s ease;
      color: white;
      display: flex;
      flex-direction: column;
      padding: env(safe-area-inset-top) 12px env(safe-area-inset-bottom) 12px;
      max-height: 100vh;
    }
    .container {
      display: flex;
      flex-direction: column;
      background: rgba(0, 0, 0, 0.35);
      backdrop-filter: blur(12px);
      border-radius: 20px;
      padding: 16px;
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.4);
      flex: 1;
      overflow: hidden;
      position: relative;
      max-height: 100vh;
    }
    .close-btn {
      position: absolute;
      top: 12px;
      right: 12px;
      width: 32px;
      height: 32px;
      border: none;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.2);
      color: white;
      font-size: 16px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10;
    }
    h1 {
      text-align: center;
      font-size: 22px;
      margin-bottom: 16px;
      text-shadow: 0 1px 2px rgba(0,0,0,0.3);
    }
    .screen { display: none; }
    .active { display: flex; flex-direction: column; flex: 1; }
    
    /* –ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω */
    .mode-btn {
      padding: 14px;
      margin: 8px 0;
      border: none;
      border-radius: 14px;
      background: rgba(255,255,255,0.9);
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
    }
    
    /* –≠–∫—Ä–∞–Ω –≤—ã–±–æ—Ä–∞ —É—Ä–æ–≤–Ω—è */
    .level-item {
      padding: 16px;
      margin: 12px 0;
      border-radius: 16px;
      background: rgba(255,255,255,0.15);
      cursor: pointer;
      transition: all 0.2s;
    }
    .level-item.selected.easy {
      background: rgba(76, 175, 80, 0.3);
      box-shadow: 0 0 0 2px #4CAF50 inset;
    }
    .level-item.selected.medium {
      background: rgba(255, 152, 0, 0.3);
      box-shadow: 0 0 0 2px #FF9800 inset;
    }
    .level-item.selected.hard {
      background: rgba(244, 67, 54, 0.3);
      box-shadow: 0 0 0 2px #F44336 inset;
    }
    .level-title {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 8px;
    }
    .level-desc {
      font-size: 14px;
      opacity: 0.9;
    }
    .start-btn {
      padding: 16px 20px;
      margin: 20px 0 0;
      border: none;
      border-radius: 14px;
      background: #4CAF50;
      color: white;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      opacity: 0.7;
      pointer-events: none;
      width: 100%;
      max-width: 300px;
      box-sizing: border-box;
      text-align: left;
      display: block;
      align-self: flex-start;
      flex: none;
      height: auto;
    }
    .start-btn.active {
      opacity: 1;
      pointer-events: auto;
    }
    
    /* –ò–≥—Ä–æ–≤–æ–π —ç–∫—Ä–∞–Ω */
    .progress {
      text-align: center;
      font-size: 14px;
      margin-bottom: 12px;
      font-weight: bold;
    }
    .stats {
      display: flex;
      justify-content: space-around;
      background: rgba(0, 0, 0, 0.25);
      padding: 8px;
      border-radius: 12px;
      margin-bottom: 12px;
      font-size: 12px;
      font-weight: 600;
    }
    .flag-container {
      background: rgba(255, 255, 255, 0.15);
      border: 2px dashed rgba(255, 255, 255, 0.35);
      border-radius: 12px;
      padding: 10px;
      margin: 12px 0;
      min-height: 120px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }
    .loading {
      text-align: center;
      padding: 30px 0;
      opacity: 0.8;
      font-size: 16px;
      width: 100%;
    }
    .flag {
      max-width: 100%;
      max-height: 100px;
      object-fit: contain;
      filter: drop-shadow(0 2px 4px rgba(0,0,0,0.4));
      display: none;
    }
    .timer-bar {
      height: 6px;
      background: rgba(255, 255, 255, 0.25);
      border-radius: 3px;
      margin: 12px 0;
      overflow: hidden;
    }
    .timer-fill {
      height: 100%;
      background: linear-gradient(to right, #4CAF50, #FFC107, #F44336);
      background-size: 300% 100%;
      width: 100%;
      transition: width 0.1s linear;
    }
    #options {
      flex: 1;
      overflow-y: auto;
      padding: 4px 0;
      margin: 8px 0;
    }
    .btn {
      display: block;
      width: 100%;
      padding: 14px;
      margin: 6px 0;
      font-size: 16px;
      font-weight: 600;
      border: none;
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.92);
      color: #333;
      cursor: pointer;
    }
    .btn:disabled {
      opacity: 0.7;
    }
    .btn.correct { background: #4CAF50 !important; color: white !important; }
    .btn.incorrect { background: #f44336 !important; color: white !important; }

    /* –°–µ—Ç–∫–∞ –¥–ª—è —Ñ–ª–∞–≥–æ–≤ */
    .options-grid {
      display: grid;
      gap: 10px;
      margin: 12px 0;
    }
    .options-grid.easy { grid-template-columns: repeat(2, 1fr); }
    .options-grid.medium { grid-template-columns: repeat(2, 1fr); }
    .options-grid.medium .btn:nth-child(5) { grid-column: span 2; }
    .options-grid.hard { grid-template-columns: repeat(2, 1fr); }

    /* –ö–Ω–æ–ø–∫–∏ —Å —Ñ–ª–∞–≥–∞–º–∏ */
    .btn.flag-option {
      padding: 6px;
      background: rgba(0, 0, 0, 0.2); /* –¢—ë–º–Ω–∞—è –ø–æ–¥–ª–æ–∂–∫–∞ */
      border: 2px solid rgba(255, 255, 255, 0.4);
      border-radius: 10px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .btn.flag-option img {
      width: 100%;
      max-height: 80px;
      object-fit: contain;
      background: white; /* –ë–µ–ª—ã–π —Ñ–æ–Ω –ø–æ–¥ –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–µ —Ñ–ª–∞–≥–∏ */
      border-radius: 6px;
    }
    .btn.flag-option:hover {
      border-color: rgba(255, 255, 255, 0.6);
    }
    #result {
      text-align: center;
      min-height: 24px;
      font-weight: bold;
      margin-top: 10px;
      font-size: 16px;
    }

    /* –§–∏–Ω–∞–ª—å–Ω—ã–π —ç–∫—Ä–∞–Ω */
    .final-screen h2 {
      font-size: 28px;
      margin: 20px 0;
    }
    .final-score {
      font-size: 60px;
      font-weight: bold;
      margin: 20px 0;
    }
    .restart-btn {
      padding: 16px;
      margin-top: 20px;
      border: none;
      border-radius: 14px;
      background: #4CAF50;
      color: white;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
    }

    /* –ö–æ–Ω—Ñ–µ—Ç—Ç–∏ */
    #confetti {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 1000;
      display: none;
    }
    
    /* –§–æ–Ω–æ–≤–∞—è –º—É–∑—ã–∫–∞ */
    .music-toggle {
      position: absolute;
      bottom: 12px;
      right: 12px;
      width: 36px;
      height: 36px;
      border: none;
      border-radius: 50%;
      background: rgba(255,255,255,0.2);
      color: white;
      font-size: 14px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    /* –ê–Ω–∏–º–∞—Ü–∏–∏ —Ñ–ª–∞–≥–∞ */
    @keyframes glow {
      0%, 100% { box-shadow: 0 0 8px #4CAF50; }
      50% { box-shadow: 0 0 20px #66bb6a; }
    }
    @keyframes glow-red {
      0%, 100% { box-shadow: 0 0 8px #f44336; }
      50% { box-shadow: 0 0 20px #ff5252; }
    }
    .flag.success {
      animation: glow 0.8s ease-in-out;
    }
    .flag.error {
      animation: glow-red 0.8s ease-in-out;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- –ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω -->
    <div id="main-screen" class="screen active">
      <h1>üåç Guess Globe</h1>
      <button class="mode-btn" onclick="startGame('flag-to-country')">
        üè≥Ô∏è –§–ª–∞–≥ ‚Üí –°—Ç—Ä–∞–Ω–∞?
      </button>
      <button class="mode-btn" onclick="startGame('country-to-flag')">
        üåç –°—Ç—Ä–∞–Ω–∞ ‚Üí –§–ª–∞–≥?
      </button>
      <div style="text-align: center; margin-top: 20px; font-size: 12px; opacity: 0.7;">
        v1.2.1
      </div>
    </div>

    <!-- –í—ã–±–æ—Ä —É—Ä–æ–≤–Ω—è -->
    <div id="level-screen" class="screen">
      <h1>–í—ã–±–µ—Ä–∏ —É—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏</h1>
      
      <div class="level-item" data-level="easy">
        <div class="level-title">üü¢ –õ—ë–≥–∫–∏–π</div>
        <div class="level-desc">30 —Å–∞–º—ã—Ö —É–∑–Ω–∞–≤–∞–µ–º—ã—Ö —Ñ–ª–∞–≥–æ–≤<br>–í—ã–±–æ—Ä –∏–∑ 4 —Å—Ç—Ä–∞–Ω</div>
      </div>
      
      <div class="level-item" data-level="medium">
        <div class="level-title">üü° –°—Ä–µ–¥–Ω–∏–π</div>
        <div class="level-desc">100 —Å—Ç—Ä–∞–Ω –º–∏—Ä–∞<br>–í—ã–±–æ—Ä –∏–∑ 5 —Å—Ç—Ä–∞–Ω</div>
      </div>
      
      <div class="level-item" data-level="hard">
        <div class="level-title">üî¥ –°–ª–æ–∂–Ω—ã–π</div>
        <div class="level-desc">–í—Å–µ 195 —Å—Ç—Ä–∞–Ω –û–û–ù<br>–í—ã–±–æ—Ä –∏–∑ 6 —Å—Ç—Ä–∞–Ω</div>
      </div>
      
      <button class="start-btn" id="start-btn">‚ñ∂Ô∏è –ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
    </div>

    <!-- –ò–≥—Ä–æ–≤–æ–π —ç–∫—Ä–∞–Ω -->
    <div id="game-screen" class="screen">
      <div class="progress">–í–æ–ø—Ä–æ—Å <span id="current">1</span> –∏–∑ 10</div>
      <div class="stats">
        <div>‚úÖ –í–µ—Ä–Ω–æ: <span id="correct">0</span></div>
      </div>

      <!-- –¢–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–∞ (–¥–ª—è —Ä–µ–∂–∏–º–∞ –°—Ç—Ä–∞–Ω–∞ ‚Üí –§–ª–∞–≥) -->
      <div id="question-text" style="text-align: center; font-size: 20px; margin: 12px 0; display: none;"></div>

      <!-- –ë–ª–æ–∫ —Ñ–ª–∞–≥–∞ (—Ç–æ–ª—å–∫–æ –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ —Ä–µ–∂–∏–º–∞) -->
      <div id="flag-block" style="display: block;">
        <div class="flag-container">
          <div id="loading" class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
          <img id="flag" class="flag" alt="–§–ª–∞–≥ —Å—Ç—Ä–∞–Ω—ã">
        </div>
      </div>

      <div class="timer-bar">
        <div id="timer-fill" class="timer-fill"></div>
      </div>

      <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ -->
      <div id="options" class="options-grid"></div>
      <div id="result"></div>
    </div>

    <!-- –§–∏–Ω–∞–ª—å–Ω—ã–π —ç–∫—Ä–∞–Ω -->
    <div id="final-screen" class="screen">
      <h2>–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞!</h2>
      <div class="final-score"><span id="final-correct">0</span>/10</div>
      <div id="final-message"></div>
      <button class="restart-btn" onclick="restartGame()">–ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
    </div>

    <button class="close-btn" onclick="window.Telegram.WebApp.close()">‚úï</button>
    <button class="music-toggle" id="music-toggle" onclick="toggleMusic()">‚ô™</button>
  </div>

  <!-- –ö–æ–Ω—Ñ–µ—Ç—Ç–∏ -->
  <div id="confetti"></div>

  <script>
    const tg = window.Telegram.WebApp;
    tg.expand();
    tg.ready();

    let currentLevel = "";
    let gameMode = "";
    let questions = [];
    let currentQuestionIndex = 0;
    let correctCount = 0;
    let timeLeft = 10;
    let timerInterval;

    // –ú—É–∑—ã–∫–∞
    function toggleMusic() {
      const bgMusic = document.getElementById('bg-music');
      const btn = document.getElementById('music-toggle');
      
      if (bgMusic.paused) {
        bgMusic.play().catch(e => console.log("Autoplay blocked"));
        btn.textContent = 'üîá';
      } else {
        bgMusic.pause();
        btn.textContent = '‚ô™';
      }
    }

    document.addEventListener('click', () => {
      const bgMusic = document.getElementById('bg-music');
      if (bgMusic.paused) {
        bgMusic.muted = true;
        bgMusic.play().then(() => {
          bgMusic.pause();
          bgMusic.muted = false;
        }).catch(() => {});
      }
    }, { once: true });

    // –ó–≤—É–∫–∏ –æ—Ç–≤–µ—Ç–æ–≤
    function playSound(type) {
      try {
        const ctx = new (window.AudioContext || window.webkitAudioContext)();
        const osc = ctx.createOscillator();
        const gain = ctx.createGain();
        
        const now = ctx.currentTime;
        gain.gain.setValueAtTime(0, now);
        gain.gain.linearRampToValueAtTime(type === "correct" ? 0.12 : 0.22, now + 0.05);
        gain.gain.linearRampToValueAtTime(0, now + 0.4);
        
        osc.connect(gain);
        gain.connect(ctx.destination);
        
        if (type === "correct") {
          osc.frequency.setValueAtTime(659.25, now);
          osc.frequency.exponentialRampToValueAtTime(783.99, now + 0.3);
        } else {
          osc.frequency.setValueAtTime(349.23, now);
          osc.frequency.exponentialRampToValueAtTime(261.63, now + 0.3);
        }
        
        osc.type = "sine";
        osc.start(now);
        osc.stop(now + 0.4);
        
        setTimeout(() => { if (ctx.state !== 'closed') ctx.close(); }, 500);
      } catch (e) {}
    }

    // –ö–æ–Ω—Ñ–µ—Ç—Ç–∏
    function createConfetti() {
      const confettiContainer = document.getElementById('confetti');
      confettiContainer.innerHTML = '';
      confettiContainer.style.display = 'block';
      
      const colors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff'];
      const width = window.innerWidth;
      const height = window.innerHeight;
      
      for (let i = 0; i < 150; i++) {
        const piece = document.createElement('div');
        piece.style.position = 'absolute';
        piece.style.width = Math.random() * 10 + 5 + 'px';
        piece.style.height = piece.style.width;
        piece.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
        piece.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
        piece.style.top = '-10px';
        piece.style.left = Math.random() * width + 'px';
        piece.style.opacity = Math.random() * 0.8 + 0.2;
        piece.style.transform = `rotate(${Math.random() * 360}deg)`;
        
        confettiContainer.appendChild(piece);
        
        const duration = Math.random() * 3 + 2;
        const delay = Math.random() * 2;
        piece.animate([
          { top: '-10px', transform: 'rotate(0deg)' },
          { top: `${height}px`, transform: `rotate(${Math.random() * 720}deg)` }
        ], {
          duration: duration * 1000,
          delay: delay * 1000,
          easing: 'cubic-bezier(0.1, 0.8, 0.2, 1)'
        });
      }
      
      setTimeout(() => { confettiContainer.style.display = 'none'; }, 5000);
    }

    // –ù–∞—á–∞–ª–æ –∏–≥—Ä—ã
    function startGame(mode) {
      gameMode = mode;
      showScreen('level-screen');
      
      document.querySelectorAll('.level-item').forEach(item => {
        item.addEventListener('click', () => {
          document.querySelectorAll('.level-item').forEach(i => {
            i.classList.remove('selected', 'easy', 'medium', 'hard');
          });
          item.classList.add('selected', item.dataset.level);
          currentLevel = item.dataset.level;
          document.getElementById('start-btn').classList.add('active');
        });
      });
      
      document.getElementById('start-btn').onclick = () => {
        if (currentLevel) {
          fetchQuestions();
        }
      };
    }

    async function fetchQuestions() {
      try {
        const response = await fetch(`https://guess-globe-backend.onrender.com/api/questions?level=${currentLevel}&mode=${gameMode}&count=10`, {
          headers: { 'Authorization': tg.initData }
        });
        questions = await response.json();
        currentQuestionIndex = 0;
        correctCount = 0;
        showScreen('game-screen');
        loadQuestion();
      } catch (e) {
        alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–æ–ø—Ä–æ—Å–æ–≤');
      }
    }

    function showScreen(screenId) {
      document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
      document.getElementById(screenId).classList.add('active');
      
      if (screenId === 'level-screen') {
        document.querySelectorAll('.level-item').forEach(i => i.classList.remove('selected', 'easy', 'medium', 'hard'));
        document.getElementById('start-btn').classList.remove('active');
        currentLevel = "";
      } else if (screenId === 'game-screen') {
        updateBackground(currentLevel);
      }
    }

    function updateBackground(level) {
      const body = document.body;
      if (level === "easy") {
        body.style.background = "linear-gradient(135deg, #4CAF50, #8BC34A)";
      } else if (level === "medium") {
        body.style.background = "linear-gradient(135deg, #FF9800, #FFC107)";
      } else {
        body.style.background = "linear-gradient(135deg, #F44336, #E91E63)";
      }
    }

    function loadQuestion() {
      if (currentQuestionIndex >= questions.length) {
        endGame();
        return;
      }
      
      const q = questions[currentQuestionIndex];
      document.getElementById('current').textContent = currentQuestionIndex + 1;
      document.getElementById('correct').textContent = correctCount;
      document.getElementById('result').textContent = '';

      // –°–∫—Ä—ã—Ç—å –≤—Å—ë
      document.getElementById('question-text').style.display = 'none';
      document.getElementById('flag-block').style.display = 'block';
      document.getElementById('options').innerHTML = '';
      document.getElementById('options').className = 'options-grid';

      if (gameMode === 'country-to-flag') {
        document.getElementById('question-text').textContent = q.text;
        document.getElementById('question-text').style.display = 'block';
        document.getElementById('flag-block').style.display = 'none';

        const optionsDiv = document.getElementById('options');
        optionsDiv.classList.add(currentLevel);

        q.options.forEach(opt => {
          const btn = document.createElement('button');
          btn.className = 'btn flag-option';
          const img = document.createElement('img');
          img.src = opt.image_url;
          img.alt = "–§–ª–∞–≥";
          btn.appendChild(img);
          btn.onclick = () => submitAnswer(opt.image_url, q.correct_answer);
          optionsDiv.appendChild(btn);
        });
      } else {
        document.getElementById('loading').style.display = 'block';
        document.getElementById('flag').style.display = 'none';

        const flagImg = document.getElementById('flag');
        flagImg.onload = () => {
          document.getElementById('loading').style.display = 'none';
          flagImg.style.display = 'block';
        };
        flagImg.src = q.image_url;

        const optionsDiv = document.getElementById('options');
        q.options.forEach(opt => {
          const btn = document.createElement('button');
          btn.className = 'btn';
          btn.textContent = opt;
          btn.onclick = () => submitAnswer(opt, q.correct_answer);
          optionsDiv.appendChild(btn);
        });
      }

      startTimer();
    }

    function startTimer() {
      timeLeft = 10;
      document.getElementById('timer-fill').style.width = '100%';
      clearInterval(timerInterval);
      timerInterval = setInterval(() => {
        timeLeft -= 0.1;
        const pct = Math.max(0, (timeLeft / 10) * 100);
        document.getElementById('timer-fill').style.width = pct + '%';
        if (timeLeft <= 0) {
          clearInterval(timerInterval);
          submitAnswer(null, questions[currentQuestionIndex].correct_answer);
        }
      }, 100);
    }

    function submitAnswer(answer, correctAnswer) {
      clearInterval(timerInterval);
      const buttons = document.querySelectorAll('.btn');
      buttons.forEach(btn => btn.disabled = true);

      let isCorrect = false;
      if (answer === null) {
        document.getElementById('result').innerHTML = '‚è∞ –í—Ä–µ–º—è –≤—ã—à–ª–æ!';
        playSound("wrong");
      } else {
        isCorrect = answer === correctAnswer;
        if (isCorrect) {
          correctCount++;
          playSound("correct");
          document.getElementById('result').innerHTML = '‚úÖ –í–µ—Ä–Ω–æ!';
          
          if (gameMode !== 'country-to-flag') {
            const flagEl = document.getElementById('flag');
            flagEl.classList.add('success');
            setTimeout(() => { flagEl.classList.remove('success'); }, 800);
          }
          
          buttons.forEach(btn => {
            if (gameMode === 'country-to-flag') {
              const img = btn.querySelector('img');
              if (img && img.src === correctAnswer) {
                btn.classList.add('correct');
              }
            } else {
              if (btn.textContent === correctAnswer) {
                btn.classList.add('correct');
              }
            }
          });
        } else {
          playSound("wrong");
          document.getElementById('result').innerHTML = '‚ùå –ù–µ–≤–µ—Ä–Ω–æ';
          
          buttons.forEach(btn => {
            if (gameMode === 'country-to-flag') {
              const img = btn.querySelector('img');
              if (img && img.src === answer) {
                btn.classList.add('incorrect');
              }
              if (img && img.src === correctAnswer) {
                btn.classList.add('correct');
              }
            } else {
              if (btn.textContent === answer) {
                btn.classList.add('incorrect');
              }
              if (btn.textContent === correctAnswer) {
                btn.classList.add('correct');
              }
            }
          });
        }
      }

      setTimeout(() => {
        currentQuestionIndex++;
        if (currentQuestionIndex < questions.length) {
          loadQuestion();
        } else {
          endGame();
        }
      }, 2500);
    }

    function endGame() {
      document.getElementById('final-correct').textContent = correctCount;
      const messageEl = document.getElementById('final-message');
      
      if (correctCount === 10) {
        messageEl.innerHTML = 'üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –ò–¥–µ–∞–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç!';
        createConfetti();
      } else if (correctCount >= 7) {
        messageEl.innerHTML = 'üëç –û—Ç–ª–∏—á–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç!';
      } else if (correctCount >= 5) {
        messageEl.innerHTML = 'üôÇ –ù–µ–ø–ª–æ—Ö–æ!';
      } else {
        messageEl.innerHTML = 'ü§î –ü–æ–ø—Ä–æ–±—É–π –µ—â—ë —Ä–∞–∑!';
      }
      
      showScreen('final-screen');
    }

    function restartGame() {
      showScreen('main-screen');
    }

    // –í —Å–∞–º–æ–º –∫–æ–Ω—Ü–µ —Å–∫—Ä–∏–ø—Ç–∞ (–ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã–≤–∞—é—â–∏–º
    document.addEventListener('DOMContentLoaded', () => {
      // –ü—ã—Ç–∞–µ–º—Å—è –≤–∫–ª—é—á–∏—Ç—å –º—É–∑—ã–∫—É –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è
      const bgMusic = document.getElementById('bg-music');
      bgMusic.volume = 0.3; // —á—É—Ç—å —Ç–∏—à–µ
      
      // –ü–µ—Ä–≤—ã–π –∫–ª–∏–∫ ‚Äî —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ
      function enableAudio() {
        bgMusic.muted = true;
        bgMusic.play().then(() => {
          bgMusic.pause();
          bgMusic.muted = false;
          // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–∫–ª—é—á–∞–µ–º –º—É–∑—ã–∫—É
          bgMusic.play().catch(() => {});
          document.getElementById('music-toggle').textContent = 'üîá';
        }).catch(() => {});
        
        document.removeEventListener('click', enableAudio);
        document.removeEventListener('touchstart', enableAudio);
      }
      
      document.addEventListener('click', enableAudio);
      document.addEventListener('touchstart', enableAudio);
    });
  </script>
</body>
</html>
